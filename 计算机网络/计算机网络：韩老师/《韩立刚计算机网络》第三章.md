[TOC]

# 关于我的仓库

- 这篇文章是我为面试准备的学习总结中的一篇
- 我将准备面试中找到的所有学习资料，写的Demo，写的博客都放在了这个仓库里[iOS-Engineer-Interview](https://github.com/KevinAshen/iOS-Engineer-Interview)
- 欢迎star👏👏
- 其中的博客在简书，CSDN都有发布
- 博客中提到的相关的代码Demo可以在仓库里相应的文件夹里找到

# 前言

- 该系列为学习韩立刚老师《计算机网络》课程的系列学习笔记，目前计划是一章写一篇
- 韩老师这个课程貌似是好几年前的，但怎么说呢，计算机网络作为计算机领域的基础，其实变化不大
- 课程在b站上：[计算机网络](https://www.bilibili.com/video/av9876107/?p=1)
- 老师的课看起来贼欢乐，看的很开心，配着弹幕那是更开心。主要老师很很实在，脚踏实地吧，讲的例子都贼接地气
- 本来是在看《趣谈网络协议》的，可惜看到第二章实在看不懂了，把我当宝搞，顶不住，所以先看下韩老师的打个基础
- 计算机网络这本书也买了，买的第七版，美丽美丽计网学起来
- 博客内容也就是截图+理解+书本，希望把基础搞好
- 作为一个计算机的学生，没点基础知识，确实8⃣️行
- 冲冲冲

# 数据链路层基本知识

## 数据链路层的简单模型

![image-20190922225637422](https://tva1.sinaimg.cn/large/006y8mN6ly1g78orx78wvj30o00g3gu3.jpg)

- 链路层不关心物理层怎么传，只关心帧的开头结尾，有没有错误
- 关心链路层之间怎么传输

## 信道类型

- 点到点信道：一对一的点对点通信方式【e.g. 两个路由器直接通过网线连接】
- 广播信道：信道使用一对多的广播通信方式，因此过程比较复杂。广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送【e.g. 交换机上连接三台电脑】【???：点对点信道不需要使用共享信道协议吗】

## 链路以及数据链路

- 链路：点对点物理线路段，中间没有任何其他交换结点【一条链路只是一条通路的一个组成部分】

- 数据链路：在物理链路上通过通信协议，软件对数据传输进行控制，这些实现协议的**硬件**以及软件就构成了数据链路
- 现在主要是通过适配器【就是网卡】来时先协议的硬件以及软件
- 一般的适配器都包括了数据链路层和物理层两个功能

## 物理层传输的是帧：

![18154E30-D6FB-445D-AA7D-4398AA72A453](https://tva1.sinaimg.cn/large/006y8mN6ly1g78p3maob8j30nz0frwjt.jpg)

- 链路层加上帧头，尾，校验值【构成帧】
- 比如火车入站，火车站从车头开始接收，受到车尾，发现数据不足校验值上说的个数，那么就会拒绝接收

## 点对点信道的数据链路层在进行通信时的主要步骤：

- 把网络层的下来的IP数据报添加首尾封装成帧
- 把封装好的帧发送给对应的数据链路层
- 收到帧后，确认错，取出IP数据发送给上一层；否则丢弃

# 传输中三个基本问题

## 封装成帧

![FE3ABE49-CC2E-4D09-AEA8-4C203ACF8347](https://tva1.sinaimg.cn/large/006y8mN6ly1g79qb3yehmj30gq0cmq6u.jpg)

- 这里注意MTU只包括数据部分，不包括头尾
- SOH：帧头【十六进制：01 二进制：0000 0001】
- EOT：帧尾【十六进制：04 二进制：0000 0100】
- ASCII表中可打印字符【可以从键盘上输入的字符】有95，不可打印的控制字符有33个

### ASCII表

| Bin(二进制) | Oct(八进制) | Dec(十进制) | Hex(十六进制) | 缩写/字符                   | 解释         |
| ----------- | ----------- | ----------- | ------------- | --------------------------- | ------------ |
| 0000 0000   | 00          | 0           | 0x00          | NUL(null)                   | 空字符       |
| 0000 0001   | 01          | 1           | 0x01          | SOH(start of headline)      | 标题开始     |
| 0000 0010   | 02          | 2           | 0x02          | STX (start of text)         | 正文开始     |
| 0000 0011   | 03          | 3           | 0x03          | ETX (end of text)           | 正文结束     |
| 0000 0100   | 04          | 4           | 0x04          | EOT (end of transmission)   | 传输结束     |
| 0000 0101   | 05          | 5           | 0x05          | ENQ (enquiry)               | 请求         |
| 0000 0110   | 06          | 6           | 0x06          | ACK (acknowledge)           | 收到通知     |
| 0000 0111   | 07          | 7           | 0x07          | BEL (bell)                  | 响铃         |
| 0000 1000   | 010         | 8           | 0x08          | BS (backspace)              | 退格         |
| 0000 1001   | 011         | 9           | 0x09          | HT (horizontal tab)         | 水平制表符   |
| 0000 1010   | 012         | 10          | 0x0A          | LF (NL line feed, new line) | 换行键       |
| 0000 1011   | 013         | 11          | 0x0B          | VT (vertical tab)           | 垂直制表符   |
| 0000 1100   | 014         | 12          | 0x0C          | FF (NP form feed, new page) | 换页键       |
| 0000 1101   | 015         | 13          | 0x0D          | CR (carriage return)        | 回车键       |
| 0000 1110   | 016         | 14          | 0x0E          | SO (shift out)              | 不用切换     |
| 0000 1111   | 017         | 15          | 0x0F          | SI (shift in)               | 启用切换     |
| 0001 0000   | 020         | 16          | 0x10          | DLE (data link escape)      | 数据链路转义 |
| 0001 0001   | 021         | 17          | 0x11          | DC1 (device control 1)      | 设备控制1    |
| 0001 0010   | 022         | 18          | 0x12          | DC2 (device control 2)      | 设备控制2    |
| 0001 0011   | 023         | 19          | 0x13          | DC3 (device control 3)      | 设备控制3    |
| 0001 0100   | 024         | 20          | 0x14          | DC4 (device control 4)      | 设备控制4    |
| 0001 0101   | 025         | 21          | 0x15          | NAK (negative acknowledge)  | 拒绝接收     |
| 0001 0110   | 026         | 22          | 0x16          | SYN (synchronous idle)      | 同步空闲     |
| 0001 0111   | 027         | 23          | 0x17          | ETB (end of trans. block)   | 结束传输块   |
| 0001 1000   | 030         | 24          | 0x18          | CAN (cancel)                | 取消         |
| 0001 1001   | 031         | 25          | 0x19          | EM (end of medium)          | 媒介结束     |
| 0001 1010   | 032         | 26          | 0x1A          | SUB (substitute)            | 代替         |
| 0001 1011   | 033         | 27          | 0x1B          | ESC (escape)                | 换码(溢出)   |
| 0001 1100   | 034         | 28          | 0x1C          | FS (file separator)         | 文件分隔符   |
| 0001 1101   | 035         | 29          | 0x1D          | GS (group separator)        | 分组符       |
| 0001 1110   | 036         | 30          | 0x1E          | RS (record separator)       | 记录分隔符   |
| 0001 1111   | 037         | 31          | 0x1F          | US (unit separator)         | 单元分隔符   |
| 0010 0000   | 040         | 32          | 0x20          | (space)                     | 空格         |
| 0010 0001   | 041         | 33          | 0x21          | !                           | 叹号         |
| 0010 0010   | 042         | 34          | 0x22          | "                           | 双引号       |
| 0010 0011   | 043         | 35          | 0x23          | #                           | 井号         |
| 0010 0100   | 044         | 36          | 0x24          | $                           | 美元符       |
| 0010 0101   | 045         | 37          | 0x25          | %                           | 百分号       |
| 0010 0110   | 046         | 38          | 0x26          | &                           | 和号         |
| 0010 0111   | 047         | 39          | 0x27          | '                           | 闭单引号     |
| 0010 1000   | 050         | 40          | 0x28          | (                           | 开括号       |
| 0010 1001   | 051         | 41          | 0x29          | )                           | 闭括号       |
| 0010 1010   | 052         | 42          | 0x2A          | *                           | 星号         |
| 0010 1011   | 053         | 43          | 0x2B          | +                           | 加号         |
| 0010 1100   | 054         | 44          | 0x2C          | ,                           | 逗号         |
| 0010 1101   | 055         | 45          | 0x2D          | -                           | 减号/破折号  |
| 0010 1110   | 056         | 46          | 0x2E          | .                           | 句号         |
| 0010 1111   | 057         | 47          | 0x2F          | /                           | 斜杠         |
| 0011 0000   | 060         | 48          | 0x30          | 0                           | 字符0        |
| 0011 0001   | 061         | 49          | 0x31          | 1                           | 字符1        |
| 0011 0010   | 062         | 50          | 0x32          | 2                           | 字符2        |
| 0011 0011   | 063         | 51          | 0x33          | 3                           | 字符3        |
| 0011 0100   | 064         | 52          | 0x34          | 4                           | 字符4        |
| 0011 0101   | 065         | 53          | 0x35          | 5                           | 字符5        |
| 0011 0110   | 066         | 54          | 0x36          | 6                           | 字符6        |
| 0011 0111   | 067         | 55          | 0x37          | 7                           | 字符7        |
| 0011 1000   | 070         | 56          | 0x38          | 8                           | 字符8        |
| 0011 1001   | 071         | 57          | 0x39          | 9                           | 字符9        |
| 0011 1010   | 072         | 58          | 0x3A          | :                           | 冒号         |
| 0011 1011   | 073         | 59          | 0x3B          | ;                           | 分号         |
| 0011 1100   | 074         | 60          | 0x3C          | <                           | 小于         |
| 0011 1101   | 075         | 61          | 0x3D          | =                           | 等号         |
| 0011 1110   | 076         | 62          | 0x3E          | >                           | 大于         |
| 0011 1111   | 077         | 63          | 0x3F          | ?                           | 问号         |
| 0100 0000   | 0100        | 64          | 0x40          | @                           | 电子邮件符号 |
| 0100 0001   | 0101        | 65          | 0x41          | A                           | 大写字母A    |
| 0100 0010   | 0102        | 66          | 0x42          | B                           | 大写字母B    |
| 0100 0011   | 0103        | 67          | 0x43          | C                           | 大写字母C    |
| 0100 0100   | 0104        | 68          | 0x44          | D                           | 大写字母D    |
| 0100 0101   | 0105        | 69          | 0x45          | E                           | 大写字母E    |
| 0100 0110   | 0106        | 70          | 0x46          | F                           | 大写字母F    |
| 0100 0111   | 0107        | 71          | 0x47          | G                           | 大写字母G    |
| 0100 1000   | 0110        | 72          | 0x48          | H                           | 大写字母H    |
| 0100 1001   | 0111        | 73          | 0x49          | I                           | 大写字母I    |
| 01001010    | 0112        | 74          | 0x4A          | J                           | 大写字母J    |
| 0100 1011   | 0113        | 75          | 0x4B          | K                           | 大写字母K    |
| 0100 1100   | 0114        | 76          | 0x4C          | L                           | 大写字母L    |
| 0100 1101   | 0115        | 77          | 0x4D          | M                           | 大写字母M    |
| 0100 1110   | 0116        | 78          | 0x4E          | N                           | 大写字母N    |
| 0100 1111   | 0117        | 79          | 0x4F          | O                           | 大写字母O    |
| 0101 0000   | 0120        | 80          | 0x50          | P                           | 大写字母P    |
| 0101 0001   | 0121        | 81          | 0x51          | Q                           | 大写字母Q    |
| 0101 0010   | 0122        | 82          | 0x52          | R                           | 大写字母R    |
| 0101 0011   | 0123        | 83          | 0x53          | S                           | 大写字母S    |
| 0101 0100   | 0124        | 84          | 0x54          | T                           | 大写字母T    |
| 0101 0101   | 0125        | 85          | 0x55          | U                           | 大写字母U    |
| 0101 0110   | 0126        | 86          | 0x56          | V                           | 大写字母V    |
| 0101 0111   | 0127        | 87          | 0x57          | W                           | 大写字母W    |
| 0101 1000   | 0130        | 88          | 0x58          | X                           | 大写字母X    |
| 0101 1001   | 0131        | 89          | 0x59          | Y                           | 大写字母Y    |
| 0101 1010   | 0132        | 90          | 0x5A          | Z                           | 大写字母Z    |
| 0101 1011   | 0133        | 91          | 0x5B          | [                           | 开方括号     |
| 0101 1100   | 0134        | 92          | 0x5C          | \                           | 反斜杠       |
| 0101 1101   | 0135        | 93          | 0x5D          | ]                           | 闭方括号     |
| 0101 1110   | 0136        | 94          | 0x5E          | ^                           | 脱字符       |
| 0101 1111   | 0137        | 95          | 0x5F          | _                           | 下划线       |
| 0110 0000   | 0140        | 96          | 0x60          | `                           | 开单引号     |
| 0110 0001   | 0141        | 97          | 0x61          | a                           | 小写字母a    |
| 0110 0010   | 0142        | 98          | 0x62          | b                           | 小写字母b    |
| 0110 0011   | 0143        | 99          | 0x63          | c                           | 小写字母c    |
| 0110 0100   | 0144        | 100         | 0x64          | d                           | 小写字母d    |
| 0110 0101   | 0145        | 101         | 0x65          | e                           | 小写字母e    |
| 0110 0110   | 0146        | 102         | 0x66          | f                           | 小写字母f    |
| 0110 0111   | 0147        | 103         | 0x67          | g                           | 小写字母g    |
| 0110 1000   | 0150        | 104         | 0x68          | h                           | 小写字母h    |
| 0110 1001   | 0151        | 105         | 0x69          | i                           | 小写字母i    |
| 0110 1010   | 0152        | 106         | 0x6A          | j                           | 小写字母j    |
| 0110 1011   | 0153        | 107         | 0x6B          | k                           | 小写字母k    |
| 0110 1100   | 0154        | 108         | 0x6C          | l                           | 小写字母l    |
| 0110 1101   | 0155        | 109         | 0x6D          | m                           | 小写字母m    |
| 0110 1110   | 0156        | 110         | 0x6E          | n                           | 小写字母n    |
| 0110 1111   | 0157        | 111         | 0x6F          | o                           | 小写字母o    |
| 0111 0000   | 0160        | 112         | 0x70          | p                           | 小写字母p    |
| 0111 0001   | 0161        | 113         | 0x71          | q                           | 小写字母q    |
| 0111 0010   | 0162        | 114         | 0x72          | r                           | 小写字母r    |
| 0111 0011   | 0163        | 115         | 0x73          | s                           | 小写字母s    |
| 0111 0100   | 0164        | 116         | 0x74          | t                           | 小写字母t    |
| 0111 0101   | 0165        | 117         | 0x75          | u                           | 小写字母u    |
| 0111 0110   | 0166        | 118         | 0x76          | v                           | 小写字母v    |
| 0111 0111   | 0167        | 119         | 0x77          | w                           | 小写字母w    |
| 0111 1000   | 0170        | 120         | 0x78          | x                           | 小写字母x    |
| 0111 1001   | 0171        | 121         | 0x79          | y                           | 小写字母y    |
| 0111 1010   | 0172        | 122         | 0x7A          | z                           | 小写字母z    |
| 0111 1011   | 0173        | 123         | 0x7B          | {                           | 开花括号     |
| 0111 1100   | 0174        | 124         | 0x7C          | \|                          | 垂线         |
| 0111 1101   | 0175        | 125         | 0x7D          | }                           | 闭花括号     |
| 0111 1110   | 0176        | 126         | 0x7E          | ~                           | 波浪号       |
| 0111 1111   | 0177        | 127         | 0x7F          | DEL (delete)                | 删除         |

### 作用

- 对于接收端，再收到SOH后，知道下面是一个帧，在接收到EOT后知道这是一个帧的结束
- 假如在SOH后面没有EOT，又收到一个SOH，说明前一个帧出现了缺漏，会直接把第一个帧丢弃，直接从第二个开始帧开始

## 透明传输

### 关于透明

- 透明是一个重要的术语，说明一个实际存在的事物看起来却好像不存在一样
- 书上说透明传输的意思是无论发送什么样的数据，都能没有任何差错地通过数据链路层，认为是数据链路层没有什么阻碍数据传输的东西
- 这个解释我觉得没什么意义啊，我认为透明是指就算数据里面出现了SOH，EOT这样的控制符，链路层也能当做没看到一样继续进行数据传输

### 使用帧头帧尾出现的问题

![82B1F821-3D7C-4ACC-B385-F9D304755C8A](https://tva1.sinaimg.cn/large/006y8mN6ly1g79qnrump7j30gt0cn0wi.jpg)

- 我们会看到在数据部分出现了EOT控制符【二进制】，那么就会直接舍弃掉后面的数据

### 解决方法

![02117FB9-945E-40B7-A0F5-4640AA046E59](https://tva1.sinaimg.cn/large/006y8mN6ly1g79qoveuumj30h00ckqaw.jpg)

- 这个其实就和我们编程的转义字符一样，在控制符前插入一个ESC，读取的时候，说白了，接收端收到的时候，对于ESC后面的字符，就会认为就是一个普通文字符，不发挥其控制作用
- 发送端插入ESC，接收端去掉ESC

## 差错检验

- 这一段看起来有点复杂，但作为面试选手，稍微了解下就行，又不会让你计算一下
- 使用CRC的检错技术，获取FCS【冗余码】
- 注意FCS是一定有的，是一个检错用的数据，但不一定是通过CRC这个技术得到的

![67E6CBE1-B6DB-4D1B-B3C7-93F40C012DA2](https://tva1.sinaimg.cn/large/006y8mN6ly1g79qurz1ajj30gs0cq41m.jpg)

![A5755C88-9697-45E9-B71A-0C1BE38DE41A](https://tva1.sinaimg.cn/large/006y8mN6ly1g79qwiqjy4j30h10ckgqk.jpg)

## 无比特差错&&无传输差错&&可靠传输

![2C3E5EEF-8C3B-49A3-ADF8-BCCF4E6F55DC](https://tva1.sinaimg.cn/large/006y8mN6ly1g79r0pyf20j30gx0cmteg.jpg)

- 使用CRC技术后，我们做到的仅仅是对帧的无差错接收，只能认为是接受到的帧没有错误
- 而做到可靠传输不仅要克服比特差错，还要克服出现传输差错
- 现在分成了两种情况：
  - 对于通信质量良好的线路，不采用确认和重传机制，不要求链路层往上提供可靠传输服务，链路层出现传输差错，由上层协议实现
  - 对于通信质量不好的线路，数据链路层协议使用确认和重传机制

#  点对点协议PPP

- 对于上网用户【比如使用ADSL拨号上网】，我们用户都是需要接入某个ISP才能进入互联网，PPP就是计算机与ISP通信时用的数据链路层协议

![A5ED5B7C-27F4-4D72-8603-4C7E7E995F46](https://tva1.sinaimg.cn/large/006y8mN6ly1g7t4l7jk9kj30f30bgjts.jpg)

- 对于PPP协议的需求：

![4293F721-3C4E-4F70-B44D-508077F422BD](https://tva1.sinaimg.cn/large/006y8mN6ly1g7t4m9zsehj30ev0b0mzo.jpg)

- PPP协议组成：

![15A28162-7BA5-401B-9C00-6B674FF5E889](https://tva1.sinaimg.cn/large/006y8mN6ly1g7t4o2eodij30et0b2af2.jpg)

- 这里要注意这里还是自下而上的，如果中间断了，上面的网络协议一定也是断的

## 协议帧格式

![05F1C497-7439-487E-94B4-2E60CC47BBAE](https://tva1.sinaimg.cn/large/006y8mN6ly1g7t4q0gg76j30er0ayq7p.jpg)

### 字节填充

- 这里注意这里的填充我理解是前面讲的SOH，EOT的详细版本，两者本质上是一回事应该是一回事
- 传输的字节流时

![1722179C-50EF-49CA-9D10-BCE16C6C8AF8](https://tva1.sinaimg.cn/large/006y8mN6gy1g7t4ve4t60j30ev0b5tdb.jpg)

### 零比特填充

- 传输的不是字节流时，面向比特时
- ![image-20200220232037996](https://tva1.sinaimg.cn/large/0082zybply1gc3a1hnmyuj313u0u0e81.jpg)

### 不使用序号和确认机制

![image-20200220232412692](https://tva1.sinaimg.cn/large/0082zybply1gc3a54r0aaj314f0u0b29.jpg)

## PPP协议的工作状态

![image-20200220233320505](https://tva1.sinaimg.cn/large/0082zybply1gc3aemnjdrj315k0u07wh.jpg)

- 流程图
![image-20200220233839942](/Users/jiangkaiwen/Library/Application Support/typora-user-images/image-20200220233839942.png)
- 这里值得注意的是网络控制NCP协议可以根据网络层不同的协议交换网络层特定的网络控制分组，这保证了我们可以在PPP两端的网络层运行不同的网络协议

# 使用广播信道的数据链路层

## 局域网的数据链路层



## CSMA/CD协议

